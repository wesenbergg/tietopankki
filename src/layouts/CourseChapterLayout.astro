---
import type { MarkdownHeading } from "astro";
import TableOfContents from "../components/client/TableOfContents.svelte";
import generateToc from "../utils/generateToc.ts";
import { getCollection } from "astro:content";
import CourseContents from "../components/client/CourseContents.svelte";
import Layout from "./Layout.astro";

export interface Props {
  title: string;
  description: string;
  permalink: string;
  headings: MarkdownHeading[];
}
const { title, description, permalink, headings } = Astro.props;
const toc = generateToc(headings);

const getCourseNav = async () => {
  const posts = await getCollection(title);

  return posts.map((post) => ({
    id: post.id,
    slug: post.slug,
    data: post.data,
    collection: post.collection,
    depth: (post.slug.split("/") || []).length,
  }));
};
let chapters = await getCourseNav();
---

<Layout {title} {description} {permalink}>
  <CourseContents {chapters} />
  <TableOfContents client:idle {toc} />
  <slot />
</Layout>
